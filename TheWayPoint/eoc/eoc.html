<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Examination of Conscience</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: #e0e0e0;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      color: #cfd8dc;
      text-align: center;
    }
    h2 {
      color: #90a4ae;
      margin-top: 20px;
    }
    .sin-item {
      background-color: #2b2b2b;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
    }
    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .dropdown-content {
      display: none;
      margin-top: 8px;
      font-size: 0.9em;
      background-color: #383838;
      padding: 10px;
      border-radius: 4px;
    }
    .show {
      display: block;
    }
    .material-icons {
      color: #90a4ae;
      cursor: pointer;
      margin-left: auto;
    }
    #generateButton {
      background-color: #607d8b;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      border: none;
      padding: 12px;
      width: 100%;
      border-radius: 4px;
      margin-top: 20px;
      cursor: pointer;
    }
    #generateButton:hover {
      background-color: #546e7a;
    }
  </style>
</head>
<body>
<h1>Examination of Conscience</h1>
<div id="sinsContainer"></div>
<button id="generateButton" onclick="generatePDF()">Generate Confession List PDF</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script>
  async function loadSins() {
    const response = await fetch('sins.json');
    const data = await response.json();
    const container = document.getElementById('sinsContainer');

    data.forEach(category => {
      const categoryHeading = document.createElement('h2');
      categoryHeading.textContent = category.category;
      container.appendChild(categoryHeading);

      category.sins.forEach(sin => {
        const sinDiv = document.createElement('div');
        sinDiv.className = 'sin-item';

        const checkboxContainer = document.createElement('label');
        checkboxContainer.className = 'checkbox-container';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.classList.add(sin.mortal ? 'mortal-sin' : 'venial-sin');
        checkboxContainer.appendChild(checkbox);

        const sinText = document.createElement('span');
        sinText.textContent = sin.question;
        checkboxContainer.appendChild(sinText);

        const expandIcon = document.createElement('span');
        expandIcon.className = 'material-icons';
        expandIcon.textContent = 'expand_more';
        expandIcon.onclick = () => {
          dropdown.classList.toggle('show');
        };

        const dropdown = document.createElement('div');
        dropdown.className = 'dropdown-content';
        dropdown.innerHTML = `
          <p><strong>${sin.mortal ? 'Mortal Sin' : 'Venial Sin'}</strong></p>
          <p><strong>Catechism Reference:</strong> CCC ${sin.ccc}</p>
          <p>${sin.details}</p>
        `;

        sinDiv.appendChild(checkboxContainer);
        sinDiv.appendChild(expandIcon);
        sinDiv.appendChild(dropdown);
        container.appendChild(sinDiv);
      });
    });
  }

  function generatePDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    const date = new Date();
    const dateString = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
    let yPosition = 10;
    let hasMortalSins = false;
    const mortalSins = [];

    pdf.setFontSize(12);
    pdf.text(`Date: ${dateString}`, 10, yPosition);
    yPosition += 10;
    pdf.setFontSize(14);
    pdf.text("Sins to Confess:", 10, yPosition);
    yPosition += 10;

    const selected = document.querySelectorAll('.sin-item input[type="checkbox"]:checked');
    if (selected.length === 0) {
      pdf.text("No sins selected.", 10, yPosition);
    } else {
      selected.forEach(cb => {
        const sinText = cb.nextSibling.textContent.trim();
        const sinDetails = cb.closest('.sin-item').querySelector('.dropdown-content').textContent.trim();
        if (cb.classList.contains('mortal-sin')) {
          hasMortalSins = true;
          mortalSins.push({ sinText, sinDetails });
        }
        if (yPosition > 270) {
          pdf.addPage();
          yPosition = 10;
        }
        pdf.setFontSize(11);
        pdf.text(`- ${sinText}`, 10, yPosition);
        yPosition += 8;
      });
    }

    yPosition += 10;
    pdf.setFontSize(14);
    pdf.text("Act of Contrition:", 10, yPosition);
    yPosition += 10;
    pdf.setFontSize(11);
    pdf.text("O my God, I am heartily sorry for having offended You...", 10, yPosition);

    if (mortalSins.length > 0) {
      yPosition += 20;
      pdf.setFontSize(13);
      pdf.text("⚠️ Mortal Sins You May Be Guilty Of:", 10, yPosition);
      yPosition += 10;
      pdf.setFontSize(11);
      mortalSins.forEach(({ sinText, sinDetails }) => {
        const lines = pdf.splitTextToSize(`• ${sinText}: ${sinDetails}`, 180);
        if (yPosition + lines.length * 6 > 270) {
          pdf.addPage();
          yPosition = 10;
        }
        lines.forEach(line => {
          pdf.text(line, 10, yPosition);
          yPosition += 6;
        });
        yPosition += 4;
      });
      alert("You have selected one or more mortal sins. Please seek confession as soon as possible.");
    }

    pdf.save("Confession_List.pdf");
  }

  window.onload = loadSins;
</script>
</body>
</html>
