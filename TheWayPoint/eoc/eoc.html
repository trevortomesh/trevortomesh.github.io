<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Examination of Conscience</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --primary-color: #607d8b;
      --background-color: #1e1e1e;
      --card-background: #2b2b2b;
      --text-color: #e0e0e0;
      --heading-color: #cfd8dc;
      --subheading-color: #90a4ae;
      --toggle-width: 3.5em;
      --toggle-height: 2em;
    }
    
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      padding: 16px;
      margin: 0;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding-bottom: 80px;
    }
    
    h1 {
      color: var(--heading-color);
      text-align: center;
      font-size: 1.8em;
      margin: 1em 0;
    }
    
    h2 {
      color: var(--subheading-color);
      margin: 1.5em 0 1em;
      font-size: 1.3em;
      border-bottom: 1px solid rgba(144, 164, 174, 0.3);
      padding-bottom: 0.5em;
    }
    
    .sin-item {
      background-color: var(--card-background);
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .sin-header {
      display: flex;
      align-items: center;
      gap: 12px;
      min-height: 48px;
    }
    
    .toggle-container {
      position: relative;
      width: var(--toggle-width);
      height: var(--toggle-height);
      flex-shrink: 0;
    }
    
    .toggle-input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
    }
    
    .toggle-label {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(144, 164, 174, 0.2);
      transition: background-color 0.3s ease;
      border-radius: var(--toggle-height);
    }
    
    .toggle-label:before {
      position: absolute;
      content: "";
      height: calc(var(--toggle-height) - 4px);
      width: calc(var(--toggle-height) - 4px);
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: transform 0.3s ease;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .toggle-input:checked + .toggle-label {
      background-color: var(--primary-color);
    }
    
    .toggle-input:checked + .toggle-label:before {
      transform: translateX(calc(var(--toggle-width) - var(--toggle-height)));
    }
    
    .mortal-sin + .toggle-label {
      border: 1px solid rgba(244, 67, 54, 0.5);
    }

    .material-icons {
      color: var(--subheading-color);
      margin-left: 8px;
    }

    .floating-button {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background-color: var(--primary-color);
      color: white;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: transform 0.2s ease;
      z-index: 1000;
    }

    .floating-button:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Examination of Conscience</h1>
    <div id="categories"></div>
  </div>
  
  <div class="floating-button" onclick="generatePDF()">
    <span class="material-icons">picture_as_pdf</span>
  </div>

  <script>
    async function loadData() {
      try {
        console.log('Fetching data...');
        const response = await fetch('./sins.json', {
          headers: {
            'Accept': 'application/json'
          }
        });
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const text = await response.text(); // Get the raw text first
        console.log('Raw response:', text.substring(0, 200)); // Log the first 200 chars
        try {
          const data = JSON.parse(text);
          console.log('Data parsed successfully:', data);
          if (!data.categories || !Array.isArray(data.categories)) {
            throw new Error('Invalid data structure: missing categories array');
          }
          renderCategories(data);
        } catch (parseError) {
          throw new Error(`JSON Parse Error: ${parseError.message}`);
        }
      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('categories').innerHTML = `
          <div style="color: #ff6b6b; padding: 20px; background: rgba(255,107,107,0.1); border-radius: 8px; margin: 20px 0;">
            <strong>Error loading data:</strong><br>
            ${error.message}<br><br>
            <em>Technical details:</em><br>
            ${error.stack ? error.stack.split('\\n')[0] : 'No stack trace available'}<br><br>
            Please check the browser's console for more details.
          </div>`;
      }
    }

    function renderCategories(data) {
      const container = document.getElementById('categories');
      
      data.categories.forEach(category => {
        // Create category heading
        const heading = document.createElement('h2');
        heading.textContent = category.category;
        container.appendChild(heading);
        
        if (category.subcategories) {
          category.subcategories.forEach(subcategory => {
            // Create subcategory heading
            const subHeading = document.createElement('h3');
            subHeading.textContent = subcategory.name;
            subHeading.style.color = 'var(--heading-color)';
            subHeading.style.fontSize = '1.1em';
            subHeading.style.marginLeft = '16px';
            subHeading.style.marginTop = '24px';
            container.appendChild(subHeading);
            
            // Create sins list for subcategory
            subcategory.sins.forEach(sin => {
          const sinDiv = document.createElement('div');
          sinDiv.className = 'sin-item';
          
          const header = document.createElement('div');
          header.className = 'sin-header';

          // Create toggle container
          const toggleContainer = document.createElement('div');
          toggleContainer.className = 'toggle-container';
          
          const toggleId = `toggle-${Math.random().toString(36).substr(2, 9)}`;
          
          const toggle = document.createElement('input');
          toggle.type = 'checkbox';
          toggle.className = `toggle-input ${sin.mortal ? 'mortal-sin' : ''}`;
          toggle.id = toggleId;
          
          const toggleLabel = document.createElement('label');
          toggleLabel.className = 'toggle-label';
          toggleLabel.setAttribute('for', toggleId);
          
          toggleContainer.appendChild(toggle);
          toggleContainer.appendChild(toggleLabel);
          
          // Create question text
          const sinText = document.createElement('span');
          sinText.textContent = sin.question;
          
          header.appendChild(toggleContainer);
          header.appendChild(sinText);
          sinDiv.appendChild(header);
          
              container.appendChild(sinDiv);
            });
          });
        }
        
        // Handle any sins directly in the category
        if (category.sins) {
          category.sins.forEach(sin => {
            const sinDiv = createSinItem(sin);
            container.appendChild(sinDiv);
          });
        }
      });
    }

    function createSinItem(sin) {
      const sinDiv = document.createElement('div');
      sinDiv.className = 'sin-item';
      
      const header = document.createElement('div');
      header.className = 'sin-header';

      // Create toggle container
      const toggleContainer = document.createElement('div');
      toggleContainer.className = 'toggle-container';
      
      const toggleId = `toggle-${Math.random().toString(36).substr(2, 9)}`;
      
      const toggle = document.createElement('input');
      toggle.type = 'checkbox';
      toggle.className = `toggle-input ${sin.mortal ? 'mortal-sin' : ''}`;
      toggle.id = toggleId;
      
      const toggleLabel = document.createElement('label');
      toggleLabel.className = 'toggle-label';
      toggleLabel.setAttribute('for', toggleId);
      
      toggleContainer.appendChild(toggle);
      toggleContainer.appendChild(toggleLabel);
      
      // Create question text
      const sinText = document.createElement('span');
      sinText.textContent = sin.question;
      
      header.appendChild(toggleContainer);
      header.appendChild(sinText);
      sinDiv.appendChild(header);
      
      return sinDiv;
    }

    function generatePDF() {
      const checkedSins = Array.from(document.querySelectorAll('.toggle-input:checked')).map(toggle => {
        const sinText = toggle.closest('.sin-item').querySelector('span').textContent;
        const isMortal = toggle.classList.contains('mortal-sin');
        return `${isMortal ? '[Mortal] ' : ''}${sinText}`;
      });

      if (checkedSins.length === 0) {
        alert('No sins selected');
        return;
      }

      const content = checkedSins.join('\\n');
      const encodedContent = encodeURIComponent(content);
      const dataUri = `data:text/plain;charset=utf-8,${encodedContent}`;
      
      const link = document.createElement('a');
      link.href = dataUri;
      link.download = 'examination.txt';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    loadData();
  </script>
</body>
</html>
